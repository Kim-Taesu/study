## **구조적** API 기본 연산

#### DataFrame

- 레코드 : Row 타입, 테이블의 로우
- 컬럼 : 각 레코드에 수행할 연산 표현식을 나타냄
- 스키마 : 각 컬럼명과 데이터 타입을 정의
- 파티셔닝 : DataFrame이나 Dataset이 클러스터에서 물리적으로 배치되는 형태를 정의
- 파티셔닝 스키마 : 파티션을 배치하는 방법을 정의
  - 파티셔닝의 분할 기준은 특정 컬럼이나 비결정론적 값을 기반으로 설정할 수 있다.
- Row 타입을 가진 Dataset이다.

---

#### 스키마

- DataFrame의 컬럼명과 데이터 타입을 정의

  - 데이터소스에서 스키마를 얻거나 직접 정의할 수 있다.

- 여러 개의 StructField 타입 필드로 구성된 StructType 객쳉디ㅏ.

  - StructField는 이름, 데이터 타입, 컬럼이 값이 없거나 null일 수 있는지 지정하는 불리언 값을 가진다.

    ```scala
    StructField(컬럼명, 컬럼 데이터 타입, null 가능 여부)
    ```

---

#### 컬럼과 표현식

- 사용자는 표현식으로 DataFrame의 컬럼을 선택, 조작, 제거할 수 있다.
- 컬럼 내용을 수정하려면 반드시 DataFrame의 스파크 트랜스포메이션을 사용해야 한다.
- col 함수나 column 함수를 사용하여 컬럼을 생성하거나 참조
- 컬럼은 컬럼명을 카탈로그에 젖아된 정보와 비교하기 전까지 미확인 상태로 남는다.

---

#### 명시적 컬럼 참조

- col 메서드로 참조
  - 조인 시 유용하다.
- col 메서드를 사용해 명시적으로 컬럼을 정의하면 스파크는 분석기 실행 단계에서 컬럼 확인 절차를 생략한다.

---

#### 표현식

- DataFrame 레코드의 여러 값에 대한 트랜스포메이션 집합을 의미

- 여러 컬럼 명을 입력으로 받아 식별하고, '단일 값'을 만들기 위해 다양한 표현식을 각 레코드에 적용

  - 단일 값 : Map, Array 같은 복합 데이터 타입일수도 있다.

- expr 함수로 사용한다.

  - DataFrame의 컬럼 참조 가능 (밑의 두 식은 같다.)

    ```scala
    expr("somCol")
    col("somCol")
    ```

---

#### 표현식으로 컬럼 표현

- 컬럼은 표현식의 일부 기능을 제공

  - col() 함수를 호출해 컬럼에 트랜스포메이션을 수행하려면 반드시 컬럼 참조를 사용해야 한다.

- expr 함수의 인수로 표현식을 사용하면 표현식을 분석해 트랜스포메이션과 컬럼 참조를 알아낼 수 있다.

  - 다음 트랜스포메이션에 컬럼 참조를 전달 가능

- 아래 식은 모두 같은 트랜스 포메이션 과정을 거친다.

  - 스파크가 연산 순서를 지정하는 논리적 트리로 컴파일하기 때문

    ```scala
    expr("colTest - 5")
    col("colTest") - 5
    expr("colTest") - 5
    ```

- **컬럼은 단지 표현식이다.**

- **컬럼과 컬럼의 트랜스포메이션은 파싱된 표현식과 동일한 논리적 실행 계획으로 컴파일**

---

#### DataFrame 컬럼에 접근하기

- 프로그래밍 방식으로 컬럼에 접근할 때는 DataFrame의 columns 속성을 사용

#### 로우  생성하기

- 각 컬럼에 해당하는 값을 사용해 Row 객체를 직접 생성할 수 있다.
- Row 객체를 직접 생성하려면 DataFrame의 스키마와 같은 순서로 값을 명시해야 한다.