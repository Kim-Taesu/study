#### 스파크 API

- 저수준의 비 구조적 API
- 고수준의 구조적 API

#### DataFrame

- 대표적인 구조적 API

- 테이블의 데이터를 로우와 컬럼으로 표현

  - 컬럼과 컬럼의 타입을 정의한 목록을 스키마라고 한다.

- 수천 대의 컴퓨터에 분산되어 저장

- ﻿대화형 모드가 아니라면 SparkSession 객체를 생성해야 한다.

  - ﻿﻿대화형 모드로 스파크를 시작하면 스파크 애플리케이션을 관리하는 SparkSession이 자동으로 생성

- 생성 예제

  - inferSchema 옵션으로 데이터를 조금 읽고 스키마 정보를 얻고 해당 로우의 데이터 타입을 스파크 데이터 타입에 맞게 분석한다.
  - header 옵션으로 첫 로우를 헤더로 지정

  ```scala
  val data = spark
  	.read
  	.option("inferSchema", "true")
  	.option("header", "true")
  	.csv("CSV_PATH.csv")
  ```

- DataFrame 객체에 explain 메서드를 호출하면 DataFrame의 계보나 스파크의 쿼리 실행 계획을 확인 할 수 있다.

  ```scala
  data.sort().explain()
  ```

  

#### 파티션

- *a logical chunk of a large data set.*
- 파티션은 클러스터의 물리적 머신에 존재하는 로우의 집합
- DataFrame의 파티션은 실행 중에 데이터가 컴퓨터클러스터에서 물리적으로 분산되는 방식을 나타낸다.
  - 파티션이 1개, 수천개의 익스큐터 : 병렬성은 1
  - 수백개의 파티션, 1개의 익스큐터 : 병렬성은 1

#### 트랜스포메이션

- 데이터를 변경하는 방법
  - 스파크의 핵심 데이터 구조는 불변성이다.
- 스파크에서 비즈니스 로직을 표현하는 핵심 개념
- 좁은 의존성
  - 각 입력 파티션이 하나의 출력 파티션에만 영향을 미친다.
  - 파이프라이닝을 자동으로 수행
    - 좁은 의존성을 지정하는 경우 모든 작업이 메모리에서 일어난다.
- 넓은 파티션
  - 하나의 입력 파티션이 여러 출력 파티션에 영향을 미친다.
  - 셔플 작업 수행
    - 셔플의 결과를 디스크에 저장한다.

#### 지연 연산

- 스파크가 연산 그래프를 처리하기 직전까지 기다리는 동작 방식
- 스파크는 특정 연산 명령이 내려진 즉시 데이터를 수정하지 않고 원시 데이터에 적용할 트랜스포메이션의 실행 계획을 생성
- 트랜스포메이션을 사용해 논리적 실행 계획을 세운다.
  - 지향성 비순환 그래프(DAG) 생성
  - 지향성 비순환 그래프의 각 단계는 불변성을 가진 신규 DataFrame을 생성한다.

#### 액션

- 실제 연산을 수행
- 트랜스포메이션으로부터 결과를 계산하도록 지시하는 명령
- 액션을 지정하면 스파크 잡이 시작된다.
  - 스파크 잡은 좁은 트랜스포메이션를 수행한 후 파티션별로 레코드 수를 넓은 트랜스포메이션한다.